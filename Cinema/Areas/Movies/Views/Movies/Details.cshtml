@model Cinema.Models.Movie
@{
    ViewData["Title"] = "Movie Details";
}

<div class="container mt-4">
    <h2 class="fw-bold mb-3">Movie Details</h2>

    <div class="card mb-3">
        <div class="row g-0">
            <div class="col-md-4">
                @if (!string.IsNullOrEmpty(Model.MainImg))
                {
                    <img src="@Url.Content($"~/images/movies/main/{Model.MainImg}")" class="img-fluid rounded-start" />
                }
            </div>
            <div class="col-md-8">
                <div class="card-body">
                    <h5 class="card-title">@Model.Name</h5>
                    <p class="card-text">@Model.Description</p>
                    <p class="card-text"><strong>Category:</strong> @Model.Category?.Name</p>
                    <p class="card-text"><strong>Cinema:</strong> @Model.Cinema?.Name</p>
                    <p class="card-text"><strong>Price:</strong> @Model.Price.ToString("0.00")</p>
                    <p class="card-text"><strong>Status:</strong> @(Model.Status ? "Active" : "Inactive")</p>
                    <p class="card-text"><small class="text-muted">Created at: @Model.CreatedAt.ToString("yyyy-MM-dd")</small></p>

                    @if (!string.IsNullOrEmpty(Model.SubImages))
                    {
                        var subs = Model.SubImages.Split(',');
                        <div class="mt-2">
                            <strong>Sub Images:</strong><br />
                            @foreach (var sub in subs)
                            {
                                <img src="@Url.Content($"~/images/movies/sub/{sub}")" width="80" class="rounded me-2 mb-2" />
                            }
                        </div>
                    }

                    <!-- Add to Cart Button -->
                    <form asp-area="Dashboard" asp-controller="Cart" asp-action="AddToCart" method="post" class="mt-3">
                        <input type="hidden" name="movieId" value="@Model.Id" />
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-cart-plus me-1"></i> Add to Cart
                        </button>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <a asp-action="Index" class="btn btn-secondary">Back to Movies</a>
</div>

<!-- Toast Notification -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
    <div id="cartToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                Movie added to cart!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('addToCartBtn').addEventListener('click', function () {
            fetch('@Url.Action("AddToCart", "Cart", new { area = "Dashboard" })', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                body: 'movieId=@Model.Id&count=1'
            })
            .then(response => {
                if (response.ok) {
                    var toastEl = document.getElementById('cartToast');
                    var toast = new bootstrap.Toast(toastEl);
                    toast.show();
                }
            });
        });
    </script>
}
